function Keys = KeyExpander(key,lenMaxPic)
%%
rcon =[0x8d, 0x01, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x80, 0x1b, 0x36, 0x6c, 0xd8 ...
    0xab, 0x4d, 0x9a, 0x2f, 0x5e, 0xbc, 0x63, 0xc6, 0x97, 0x35, 0x6a, 0xd4, 0xb3, 0x7d ...
    0xfa, 0xef, 0xc5, 0x91, 0x39, 0x72, 0xe4, 0xd3, 0xbd, 0x61, 0xc2, 0x9f, 0x25, 0x4a ...
    0x94, 0x33, 0x66, 0xcc, 0x83, 0x1d, 0x3a, 0x74, 0xe8, 0xcb, 0x8d, 0x01, 0x02, 0x04 ...
    0x08, 0x10, 0x20, 0x40, 0x80, 0x1b, 0x36, 0x6c, 0xd8, 0xab, 0x4d, 0x9a, 0x2f, 0x5e ...
    0xbc, 0x63, 0xc6, 0x97, 0x35, 0x6a, 0xd4, 0xb3, 0x7d, 0xfa, 0xef, 0xc5, 0x91, 0x39 ...
    0x72, 0xe4, 0xd3, 0xbd, 0x61, 0xc2, 0x9f, 0x25, 0x4a, 0x94, 0x33, 0x66, 0xcc, 0x83 ...
    0x1d, 0x3a, 0x74, 0xe8, 0xcb, 0x8d, 0x01, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x80 ...
    0x1b, 0x36, 0x6c, 0xd8, 0xab, 0x4d, 0x9a, 0x2f, 0x5e, 0xbc, 0x63, 0xc6, 0x97, 0x35 ...
    0x6a, 0xd4, 0xb3, 0x7d, 0xfa, 0xef, 0xc5, 0x91, 0x39, 0x72, 0xe4, 0xd3, 0xbd, 0x61 ...
    0xc2, 0x9f, 0x25, 0x4a, 0x94, 0x33, 0x66, 0xcc, 0x83, 0x1d, 0x3a, 0x74, 0xe8, 0xcb ...
    0x8d, 0x01, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x80, 0x1b, 0x36, 0x6c, 0xd8, 0xab ...
    0x4d, 0x9a, 0x2f, 0x5e, 0xbc, 0x63, 0xc6, 0x97, 0x35, 0x6a, 0xd4, 0xb3, 0x7d, 0xfa ...
    0xef, 0xc5, 0x91, 0x39, 0x72, 0xe4, 0xd3, 0xbd, 0x61, 0xc2, 0x9f, 0x25, 0x4a, 0x94 ...
    0x33, 0x66, 0xcc, 0x83, 0x1d, 0x3a, 0x74, 0xe8, 0xcb, 0x8d, 0x01, 0x02, 0x04, 0x08 ...
    0x10, 0x20, 0x40, 0x80, 0x1b, 0x36, 0x6c, 0xd8, 0xab, 0x4d, 0x9a, 0x2, 0x5e, 0xbc ...
    0x63, 0xc6, 0x97, 0x35, 0x6a, 0xd4, 0xb3, 0x7d, 0xfa, 0xef, 0xc5, 0x91, 0x39, 0x72 ...
    0xe4, 0xd3, 0xbd, 0x61, 0xc2, 0x9f, 0x25, 0x4a, 0x94, 0x33, 0x66, 0xcc, 0x83, 0x1d ...
    0x3a, 0x74, 0xe8, 0xcb, 0x8d]';

sBox = ['637c777bf26b6fc53001672bfed7ab76';...
    'ca82c97dfa5947f0add4a2af9ca472c0';...
    'b7fd9326363ff7cc34a5e5f171d83115';...
    '04c723c31896059a071280e2eb27b275';...
    '09832c1a1b6e5aa0523bd6b329e32f84';...
    '53d100ed20fcb15b6acbbe394a4c58cf';...
    'd0efaafb434d338545f9027f503c9fa8';...
    '51a3408f929d38f5bcb6da2110fff3d2';...
    'cd0c13ec5f974417c4a77e3d645d1973';...
    '60814fdc222a908846eeb814de5e0bdb';...
    'e0323a0a4906245cc2d3ac629195e479';...
    'e7c8376d8dd54ea96c56f4ea657aae08';...
    'ba78252e1ca6b4c6e8dd741f4bbd8b8a';...
    '703eb5664803f60e613557b986c11d9e';...
    'e1f8981169d98e949b1e87e9ce5528df';...
    '8ca1890dbfe6426841992d0fb054bb16'];
sBox = uint8(hex2dec(reshape(sBox',2,[])'));

Keys = KeyExpansion(key,ceil(lenMaxPic/16));

%% %%%%%% This part will Extent the kye %%%%%%%%%
% Noteworthy: We will Expand one 16 bytes Key to the lenth of each Face.
% we use the same key Expansion methode used in AES but its not necessarily to use the same methode

    function state = SubBytes(state16bit)
        state16bit = uint16(state16bit);
        state = sBox(state16bit+1);
    end
    function iii = RCon(state16bit)
        state16bit = uint16(state16bit);
        iii = rcon(state16bit+1);
    end

    function in = KeyExpansionCore(in,i) %in is uint16
        in = [in(2:4); in(1)];
        in = SubBytes(in);
        in(1) = bitxor(in(1),RCon(mod(i,255)+1));
    end

    function expandedKeys = KeyExpansion(inputKey,numberOfRounds)
        expandedKeys = zeros((numberOfRounds+1)*16,1,'uint8');
        expandedKeys(1:16) = inputKey(:);
        bytesGenerated = 16;
        rconIteration = 1;
        while bytesGenerated < (numberOfRounds+1)*16
            tempk = expandedKeys(bytesGenerated-3:bytesGenerated);
            if (mod(bytesGenerated,16) ==0)
                tempk = KeyExpansionCore(tempk,rconIteration);
                rconIteration = rconIteration+1;
            end
            for ind = 1:4
                expandedKeys(bytesGenerated+1) = bitxor(expandedKeys(bytesGenerated - 15),tempk(ind));
                bytesGenerated = bytesGenerated+1;
            end
        end
        expandedKeys = reshape(expandedKeys,4,[]);
    end



end



